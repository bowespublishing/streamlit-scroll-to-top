{"ast":null,"code":"import{Streamlit,StreamlitComponentBase,withStreamlitConnection}from\"streamlit-component-lib\";import React from\"react\";import{PDFDocument}from\"pdf-lib\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";class PDFComponent extends StreamlitComponentBase{constructor(){super(...arguments);this.isProcessing=false;// Guard to prevent double execution\nthis.totalImages=0;// Total number of images\nthis.processedImages=0;// Number of processed images\nthis.render=()=>{const imageData=this.props.args[\"imageData\"];// Single image\nconst fileName=this.props.args[\"fileName\"]||\"output.pdf\";// Single image file name\nconst imageList=this.props.args[\"imageList\"];const dpi=this.props.args[\"dpi\"]||300;const pageSize=this.props.args[\"pageSize\"]||{width:8.5,height:11};const bleed=this.props.args[\"bleed\"]||false;if(!this.isProcessing){if(imageData){this.isProcessing=true;this.convertSingleImageToPdf(imageData,fileName,dpi,pageSize,bleed);}else if(imageList&&imageList.length>0){this.isProcessing=true;this.totalImages=imageList.length;this.processedImages=0;this.convertImagesToSinglePdf(imageList,dpi,pageSize,bleed);}}return/*#__PURE__*/_jsx(\"div\",{children:this.isProcessing&&this.totalImages>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"progress\",{value:this.processedImages,max:this.totalImages,style:{width:\"100%\"}}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Processing image \",this.processedImages,\" of \",this.totalImages]})]})});};this.convertSingleImageToPdf=(imageData,fileName,dpi,pageSize,bleed)=>{const pdfDoc=PDFDocument.create();pdfDoc.then(doc=>{this.addImageToPdf(doc,imageData,dpi,pageSize,bleed);doc.save().then(pdfBytes=>{this.triggerDownload(pdfBytes,fileName);this.isProcessing=false;Streamlit.setComponentValue(true);// Indicate success\n});});};this.convertImagesToSinglePdf=(imageList,dpi,pageSize,bleed)=>{const pdfDoc=PDFDocument.create();pdfDoc.then(doc=>{const processNextImage=index=>{if(index>=imageList.length){// All images processed\ndoc.save().then(pdfBytes=>{this.triggerDownload(pdfBytes,\"bulk_images.pdf\");this.isProcessing=false;Streamlit.setComponentValue(true);// Indicate success\n});return;}const{imageData}=imageList[index];this.addImageToPdf(doc,imageData,dpi,pageSize,bleed);this.processedImages=index+1;// Update progress\nthis.forceUpdate();// Ensure progress bar updates\nprocessNextImage(index+1);// Process the next image\n};processNextImage(0);// Start processing the first image\n});};this.addImageToPdf=(pdfDoc,imageData,dpi,pageSize,bleed)=>{const imageBytes=Uint8Array.from(atob(imageData),c=>c.charCodeAt(0));pdfDoc.embedPng(imageBytes).then(embeddedImage=>{const pageWidthInPoints=pageSize.width*72;const pageHeightInPoints=pageSize.height*72;const margin=0.75*72;const contentWidth=pageWidthInPoints-2*margin;const contentHeight=pageHeightInPoints-2*margin;const widthRatio=contentWidth/embeddedImage.width;const heightRatio=contentHeight/embeddedImage.height;const scale=Math.min(widthRatio,heightRatio);const scaledWidth=embeddedImage.width*scale;const scaledHeight=embeddedImage.height*scale;const xOffset=(pageWidthInPoints-scaledWidth)/2;const yOffset=(pageHeightInPoints-scaledHeight)/2;const page=pdfDoc.addPage([pageWidthInPoints,pageHeightInPoints]);page.drawImage(embeddedImage,{x:xOffset,y:yOffset,width:scaledWidth,height:scaledHeight});});};this.triggerDownload=(pdfBytes,fileName)=>{const blob=new Blob([pdfBytes],{type:\"application/pdf\"});const url=URL.createObjectURL(blob);const link=document.createElement(\"a\");link.href=url;link.download=fileName;document.body.appendChild(link);link.click();document.body.removeChild(link);};}}export default withStreamlitConnection(PDFComponent);","map":{"version":3,"names":["Streamlit","StreamlitComponentBase","withStreamlitConnection","React","PDFDocument","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PDFComponent","constructor","arguments","isProcessing","totalImages","processedImages","render","imageData","props","args","fileName","imageList","dpi","pageSize","width","height","bleed","convertSingleImageToPdf","length","convertImagesToSinglePdf","children","value","max","style","pdfDoc","create","then","doc","addImageToPdf","save","pdfBytes","triggerDownload","setComponentValue","processNextImage","index","forceUpdate","imageBytes","Uint8Array","from","atob","c","charCodeAt","embedPng","embeddedImage","pageWidthInPoints","pageHeightInPoints","margin","contentWidth","contentHeight","widthRatio","heightRatio","scale","Math","min","scaledWidth","scaledHeight","xOffset","yOffset","page","addPage","drawImage","x","y","blob","Blob","type","url","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","removeChild"],"sources":["C:/Users/lukeb/Downloads/my_component/pdf_component/frontend/src/MyComponent.tsx"],"sourcesContent":["import {\n  Streamlit,\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\";\nimport React, { ReactNode } from \"react\";\nimport { PDFDocument } from \"pdf-lib\";\n\nclass PDFComponent extends StreamlitComponentBase {\n  private isProcessing: boolean = false; // Guard to prevent double execution\n  private totalImages: number = 0; // Total number of images\n  private processedImages: number = 0; // Number of processed images\n\n  public render = (): ReactNode => {\n    const imageData = this.props.args[\"imageData\"] as string; // Single image\n    const fileName = this.props.args[\"fileName\"] || \"output.pdf\"; // Single image file name\n    const imageList = this.props.args[\"imageList\"] as Array<{ imageData: string; fileName: string }>;\n    const dpi = this.props.args[\"dpi\"] || 300;\n    const pageSize = this.props.args[\"pageSize\"] || { width: 8.5, height: 11 };\n    const bleed = this.props.args[\"bleed\"] || false;\n\n    if (!this.isProcessing) {\n      if (imageData) {\n        this.isProcessing = true;\n        this.convertSingleImageToPdf(imageData, fileName, dpi, pageSize, bleed);\n      } else if (imageList && imageList.length > 0) {\n        this.isProcessing = true;\n        this.totalImages = imageList.length;\n        this.processedImages = 0;\n        this.convertImagesToSinglePdf(imageList, dpi, pageSize, bleed);\n      }\n    }\n\n    return (\n      <div>\n        {this.isProcessing && this.totalImages > 0 && (\n          <>\n            <progress\n              value={this.processedImages}\n              max={this.totalImages}\n              style={{ width: \"100%\" }}\n            ></progress>\n            <p>\n              Processing image {this.processedImages} of {this.totalImages}\n            </p>\n          </>\n        )}\n      </div>\n    );\n  };\n\n  private convertSingleImageToPdf = (\n    imageData: string,\n    fileName: string,\n    dpi: number,\n    pageSize: { width: number; height: number },\n    bleed: boolean\n  ): void => {\n    const pdfDoc = PDFDocument.create();\n\n    pdfDoc.then((doc) => {\n      this.addImageToPdf(doc, imageData, dpi, pageSize, bleed);\n      doc.save().then((pdfBytes) => {\n        this.triggerDownload(pdfBytes, fileName);\n        this.isProcessing = false;\n        Streamlit.setComponentValue(true); // Indicate success\n      });\n    });\n  };\n\n  private convertImagesToSinglePdf = (\n    imageList: Array<{ imageData: string; fileName: string }>,\n    dpi: number,\n    pageSize: { width: number; height: number },\n    bleed: boolean\n  ): void => {\n    const pdfDoc = PDFDocument.create();\n\n    pdfDoc.then((doc) => {\n      const processNextImage = (index: number): void => {\n        if (index >= imageList.length) {\n          // All images processed\n          doc.save().then((pdfBytes) => {\n            this.triggerDownload(pdfBytes, \"bulk_images.pdf\");\n            this.isProcessing = false;\n            Streamlit.setComponentValue(true); // Indicate success\n          });\n          return;\n        }\n\n        const { imageData } = imageList[index];\n        this.addImageToPdf(doc, imageData, dpi, pageSize, bleed);\n        this.processedImages = index + 1; // Update progress\n        this.forceUpdate(); // Ensure progress bar updates\n        processNextImage(index + 1); // Process the next image\n      };\n\n      processNextImage(0); // Start processing the first image\n    });\n  };\n\n  private addImageToPdf = (\n    pdfDoc: PDFDocument,\n    imageData: string,\n    dpi: number,\n    pageSize: { width: number; height: number },\n    bleed: boolean\n  ): void => {\n    const imageBytes = Uint8Array.from(atob(imageData), (c) => c.charCodeAt(0));\n\n    pdfDoc.embedPng(imageBytes).then((embeddedImage) => {\n      const pageWidthInPoints = pageSize.width * 72;\n      const pageHeightInPoints = pageSize.height * 72;\n\n      const margin = 0.75 * 72;\n      const contentWidth = pageWidthInPoints - 2 * margin;\n      const contentHeight = pageHeightInPoints - 2 * margin;\n\n      const widthRatio = contentWidth / embeddedImage.width;\n      const heightRatio = contentHeight / embeddedImage.height;\n      const scale = Math.min(widthRatio, heightRatio);\n\n      const scaledWidth = embeddedImage.width * scale;\n      const scaledHeight = embeddedImage.height * scale;\n      const xOffset = (pageWidthInPoints - scaledWidth) / 2;\n      const yOffset = (pageHeightInPoints - scaledHeight) / 2;\n\n      const page = pdfDoc.addPage([pageWidthInPoints, pageHeightInPoints]);\n      page.drawImage(embeddedImage, {\n        x: xOffset,\n        y: yOffset,\n        width: scaledWidth,\n        height: scaledHeight,\n      });\n    });\n  };\n\n  private triggerDownload = (pdfBytes: Uint8Array, fileName: string): void => {\n    const blob = new Blob([pdfBytes], { type: \"application/pdf\" });\n    const url = URL.createObjectURL(blob);\n\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = fileName;\n    document.body.appendChild(link);\n\n    link.click();\n    document.body.removeChild(link);\n  };\n}\n\nexport default withStreamlitConnection(PDFComponent);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}